<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Chillamp Selector ðŸŽ¸</title>
</head>
<body>
  <h1>ðŸŽ¸ Chillamp Selector</h1>

  <!-- SÃ©lection Bassiste -->
  <label for="bassiste-select">Bassiste :</label>
  <select id="bassiste-select" name="bassiste" required>
    <option value="">-- Choisissez un bassiste --</option>
  </select><br><br>

  <!-- SÃ©lection Basse -->
  <label for="basse-select">Basse :</label>
  <select id="basse-select" name="basse" required>
    <option value="">-- Choisissez une basse --</option>
  </select><br><br>

  <!-- SÃ©lection Ampli -->
  <label for="ampli-select">Ampli :</label>
  <select id="ampli-select" name="ampli" required>
    <option value="">-- Choisissez un ampli --</option>
  </select><br><br>

  <!-- SÃ©lection Effets -->
  <label for="effets-select">Effets :</label>
  <select id="effets-select" name="effets" multiple size="6">
  </select><br><br>

  <!-- SÃ©lection Baffle -->
  <label for="baffle-select">Baffle :</label>
  <select id="baffle-select" name="baffle" required>
    <option value="">-- Choisissez un baffle --</option>
  </select><br><br>

  <!-- Bouton GÃ©nÃ©ration PDF -->
  <button id="generate-pdf-btn">ðŸŽ¼ GÃ©nÃ©rer le PDF</button>

  <script>
    // Chargement Bassistes (corrigÃ©)
    fetch("/api/liste_bassistes")
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById("bassiste-select");
        data.forEach(b => {
          const option = document.createElement("option");
          option.text = `${b.nom} ${b.prenom} (${b.groupe})`;
          option.value = b.cle;
          select.appendChild(option);
        });
      });

    // Chargement Basses
    fetch("/api/liste_basses")
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById("basse-select");
        data.forEach(name => {
          const option = document.createElement("option");
          option.value = name;
          option.text = name;
          select.appendChild(option);
        });
      });

    // Chargement Amplis
    fetch("/api/liste_amplis")
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById("ampli-select");
        data.forEach(name => {
          const option = document.createElement("option");
          option.value = name;
          option.text = name;
          select.appendChild(option);
        });
      });

    // Chargement Effets
    fetch("/api/liste_effets")
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById("effets-select");
        data.forEach(name => {
          const option = document.createElement("option");
          option.value = name;
          option.text = name;
          select.appendChild(option);
        });
      });

    // Chargement Baffles
    fetch("/api/liste_baffles")
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById("baffle-select");
        data.forEach(name => {
          const option = document.createElement("option");
          option.value = name;
          option.text = name;
          select.appendChild(option);
        });
      });

    // GÃ©nÃ©ration PDF
    document.getElementById("generate-pdf-btn").addEventListener("click", () => {
      const bassiste = document.getElementById("bassiste-select").value;
      const basse = document.getElementById("basse-select").value;
      const ampli = document.getElementById("ampli-select").value;
      const baffle = document.getElementById("baffle-select").value;
      const effets = Array.from(document.getElementById("effets-select").selectedOptions).map(opt => opt.value);

      if (!bassiste || !basse || !ampli || !baffle) {
        alert("Merci de remplir tous les champs requis.");
        return;
      }

      fetch("/api/preset/pdf", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ bassiste, basse, ampli, effets, baffle })
      })
      .then(response => {
        if (!response.ok) throw new Error("Erreur lors de la gÃ©nÃ©ration du PDF.");
        return response.blob();
      })
      .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "preset_chillamp.pdf";
        document.body.appendChild(a);
        a.click();
        a.remove();
      })
      .catch(error => alert(error.message));
    });
  </script>
</body>
</html>
